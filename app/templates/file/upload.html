{% extends 'base.html' %}

{% block title %} Login {% endblock %}

{% block body %}
{% include 'header.html' %}
<div class="container mt-3">
    <h2>Upload file</h2>
    <form action="/files/upload" method="post" enctype="multipart/form-data" class="mb-3" id="uploadForm">
        <input type="file" name="file" class="form-control mb-2" required>
        <button type="submit" class="btn btn-primary">Upload</button>
    </form>
    <a href="/files/list" class="btn btn-link">Xem danh sách file</a>

    <!-- Toast container -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100">
        <div id="flash-toast" class="toast align-items-center text-bg-primary border-0" role="alert"
             aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div id="flash-toast-body" class="toast-body"></div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
                        aria-label="Close"></button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.getElementById("uploadForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const formData = new FormData(e.target);
      const response = await fetch("/files/upload", {
        method: "POST",
        body: formData
      });

      const result = await response.json();

      // Setup toast
      const toastEl = document.getElementById("flash-toast");
      const toastBody = document.getElementById("flash-toast-body");

      // Set màu sắc theo status
      if (result.status === "success") {
        toastEl.classList.remove("text-bg-danger");
        toastEl.classList.add("text-bg-success");
      } else {
        toastEl.classList.remove("text-bg-success");
        toastEl.classList.add("text-bg-danger");
      }

      toastBody.textContent = result.message;

      const toast = new bootstrap.Toast(toastEl);
      toast.show();

      if (result.status === "success") {
        setTimeout(() => {
          window.location.href = "/files/list";
        }, 500);
      }
    });
</script>
{% endblock %}